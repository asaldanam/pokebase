---

---

<div class="h-dvh w-full">
	<div id="PokemonTable" class="h-full w-full"></div>
	<div class="absolute bottom-0 w-full max-w-full px-3 backdrop-blur-md">
		<div id="PokemonTableFilters" class="flex flex-wrap gap-1 overflow-x-auto py-3"></div>
	</div>
</div>

<script>
	import {
		ClientSideRowModelModule,
		createGrid,
		DateFilterModule,
		ModuleRegistry,
		NumberFilterModule,
		TextFilterModule,
		ValidationModule,
		type FilterChangedEvent
	} from 'ag-grid-community';
	import { createPokemonTableCols } from './PokemonTable.cols';
	import { getPokemonTableColsData, getPokemonTableRowsData } from './PokemonTable.data';
	import { createFilterPillsManager } from './PokemonTable.filters';
	import { createPokemonTableTheme } from './PokemonTable.theme';

	if (typeof window !== 'undefined') {
		ModuleRegistry.registerModules([
			ClientSideRowModelModule,
			TextFilterModule,
			NumberFilterModule,
			DateFilterModule,
			...(process.env.NODE_ENV !== 'production' ? [ValidationModule] : [])
		]);

		const lang = navigator.language.split('-')[0] || 'en';
		const { stats, types } = await getPokemonTableColsData({ lang });

		// Crear el manager de filtros
		const filterManager = createFilterPillsManager({ stats, types });

		// FunciÃ³n para manejar cambios en los filtros
		function onFilterChanged(event: FilterChangedEvent) {
			filterManager.onFilterChanged(event);
		}

		const colorscheme = window.matchMedia('(prefers-color-scheme: dark)');

		const grid = createGrid(document.querySelector('#PokemonTable') as HTMLElement, {
			columnDefs: createPokemonTableCols({ lang, stats, types }),
			defaultColDef: { flex: 1 },
			rowHeight: 52,
			headerHeight: 32,
			rowData: [],
			theme: createPokemonTableTheme({
				mode: colorscheme.matches ? 'dark' : 'light'
			}),
			groupDefaultExpanded: -1,
			onFilterChanged: onFilterChanged
		});

		const { rows } = await getPokemonTableRowsData({ lang });
		grid.setGridOption('rowData', rows);

		// Inicializar el manager de filtros
		filterManager.init('PokemonTableFilters', grid);

		// Escuchar cambios en el tema del sistema
		colorscheme.addEventListener('change', (e: MediaQueryListEvent | MediaQueryList) => {
			const mode = e.matches ? 'dark' : 'light';
			grid.setGridOption('theme', createPokemonTableTheme({ mode }));
		});
	}
</script>

<style is:global>
	.ag-watermark *,
	.ag-watermark::before {
		display: none !important;
		visibility: hidden !important;
		opacity: 0 !important;
	}

	.ag-header-icon.ag-header-cell-filter-button {
		padding: 0.35rem 0.75rem;
		margin-right: -0.75rem;
		background: rgba(1, 1, 1, 0.05);
		border-radius: 0.375rem;
	}

	.ag-header-cell.ag-floating-filter {
		padding-left: 0 !important;
	}

	/* Estilos para los pills de filtros */
	#PokemonTableFilters {
		scrollbar-width: thin;
		scrollbar-color: rgba(255, 255, 255, 0.5) transparent;
	}

	#PokemonTableFilters::-webkit-scrollbar {
		height: 4px;
	}

	#PokemonTableFilters::-webkit-scrollbar-track {
		background: transparent;
	}

	#PokemonTableFilters::-webkit-scrollbar-thumb {
		background-color: rgba(255, 255, 255, 0.5);
		border-radius: 2px;
	}

	#PokemonTableFilters::-webkit-scrollbar-thumb:hover {
		background-color: rgba(255, 255, 255, 0.7);
	}
</style>
